{% set activePropertyId = activeProperty.getId %}
{% for property in properties %}
    {% if property.isFloorPlan %}
        {{ include('partials/home-finder/type/floorplan-grid.twig', { property: property, nextPageUrl: nextPageUrl, activeOffering: activeOffering, current_user: current_user, activePropertyId: activePropertyId}, with_context = false) }}
    {% else %}
        {{ include('partials/home-finder/type/property-grid.twig', { property: property, nextPageUrl: nextPageUrl, activeProperty: activeOffering, current_user: current_user, page: page, pages: pages, name: name, activePropertyId: activePropertyId }, with_context = false) }}
    {% endif %}
{% endfor %}

{# TODO: Sort out implementation of pagination on search results #}

{# TODO: Lets setup pagination instead of infinite load #}

{% if properties|length > 0 %}
    <script>
        if (typeof locations === 'undefined') {
            locations = [];
        }

        {% for property in properties %}
        {% if property.latitude and property.longitude and property.isFromPropertyBase %}

        locations.push([
            '{{ property.address_web }}',
            '{{ property.latitude }}',
            '{{ property.longitude }}',
            '4',
            '{{ property.link }}',
            '{% filter combineLines|escape('js') %}{% include 'partials/home-finder/map-tool-tip.twig' with { property: property } only %}{% endfilter %}',
            {% if property.getPropertyType == 'Homesite' %}0{% else %}'{{ property.getPropertyType }}'{% endif %}
        ]);

        {% endif %}
        {% endfor %}
    </script>
{% endif %}
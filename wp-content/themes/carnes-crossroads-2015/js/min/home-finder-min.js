Number.prototype.formatMoney=function(e,i,t){var n=this,e=isNaN(e=Math.abs(e))?2:e,i=void 0==i?".":i,t=void 0==t?",":t,o=n<0?"-":"",s=parseInt(n=Math.abs(+n||0).toFixed(e))+"",a=(a=s.length)>3?a%3:0;return o+(a?s.substr(0,a)+t:"")+s.substr(a).replace(/(\d{3})(?=\d)/g,"$1"+t)+(e?i+Math.abs(n-s).toFixed(e).slice(2):"")},jQuery(function($){function e(){N=document.getElementById("legend-items"),H=document.getElementsByClassName("squared-checkbox"),B=document.getElementsByClassName("map-results-box"),q=L.mapbox.map("map","mapbox.streets",{maxZoom:18,minZoom:15,scrollWheelZoom:"center"}).setView([33.055457,-80.103917],17),D=L.mapbox.featureLayer().addTo(q);for(var e={type:"FeatureCollection",features:[]},n=0;n<locations.length;n++)e.features.push({type:"Feature",geometry:{type:"Point",coordinates:[parseFloat(locations[n][2]),parseFloat(locations[n][1])]},properties:{address:locations[n][0],"marker-color":"Single Family Home"===locations[n][6]?"#b06a6a":"Condominium"===locations[n][6]||"Townhome"===locations[n][6]?"#0a8c7c":"#c9c23d","pop-up":locations[n][5],"listing-type":"Single Family Home"===locations[n][6]?"available-homes":"Condominium"===locations[n][6]||"Townhome"===locations[n][6]?"available-townhomes":"available-homesites"}});D.setGeoJSON(e);var o=L.tileLayer(DI.templateUri+"/img/imap/tiles/{z}/{x}/{y}.png").addTo(q);N.onchange=t,t(),q.eachLayer(function(e){e.feature&&e.bindPopup(e.feature.properties["pop-up"],L.popup({autoPan:!0}))});for(var n=0;n<B.length;n++)B[n].onmouseover=i}function i(){var e=$(this).find($("div.map-address")).text().trim();q.eachLayer(function(i){i.feature&&i.feature.properties.address===e&&i.openPopup()})}function t(){for(var e=[],i=0;i<H.length;i++)H[i].childNodes[1].checked&&e.push(H[i].childNodes[1].name);return D.setFilter(function(i){return e.indexOf(i.properties["listing-type"])!==-1}),!1}function n(){return $("h2.listings-title").text().toLowerCase().replace(/ /g,"-").replace(/[^\w-]+/g,"")}function o(){if($("div.listings-wrapper").find("div.listing").length>0){var e=$("div.listings-wrapper").find("div.listing").first();if(e.hasClass("offering")||e.hasClass("floor-plan"))e.trigger("click");else{var i=e.attr("data-property-id");d("_",i)}}else d("_","_")}function s(){$("div.listings-wrapper").fadeTo("slow",.3),M.hide(),c(),$.get("/api/home-finder/saved-listings/page/1",{sort:R},function(e){var i=e.rsp,t=e.total;p(),$("h2.listings-title").text("Saved Listings"),$("div.results-count").text(pluralize("Result",t,!0)),$("div.listings-wrapper").html(i).fadeTo("slow",1),P(),$("#filter-searchAddress").val(""),$("div.listings-wrapper").find("div.listing").first().trigger("click")})}function a(){$("div.listings-wrapper").fadeTo("slow",.3),M.hide(),c(),$.get("/api/home-finder/recently-listed/page/1",{},function(e){var i=e.rsp,t=e.total;p(),$("h2.listings-title").text("Recently Listed"),$("div.results-count").text(pluralize("Result",t,!0)),$("div.listings-wrapper").html(i).fadeTo("slow",1),P(),$("#filter-searchAddress").val(""),o()})}function r(){$("div.listings-wrapper").fadeTo("slow",.3),M.hide(),c(),$.get("/api/home-finder/featured-properties/page/1",{sort:R},function(e){var i=e.rsp,t=e.total;p(),$("h2.listings-title").text("Featured Listings"),$("div.results-count").text(pluralize("Result",t,!0)),$("div.listings-wrapper").html(i).fadeTo("slow",1),P(),$("#filter-searchAddress").val(""),o()})}function l(){$("div.listings-wrapper").fadeTo("slow",.3),P(),u("default",!0)}function d(e,i){$("div.single-listing-col").fadeTo("slow",.3),$.get("/api/home-finder/properties/"+i,{},function(e){var i=e.rsp;$("div.single-listing-col").html(i).fadeTo("slow",1),$("div.single-listing-col .listing-images").slick({lazyLoad:"ondemand",dots:!1,infinite:!1,speed:300,slidesToShow:2,slidesToScroll:1,centerMode:!1,arrows:!0,variableWidth:!0,respondTo:"window",responsive:[{breakpoint:991,settings:{slidesToShow:1,slidesToScroll:1,infinite:!1,variableWidth:!0}}]}),F()})}function c(){$("div.listings-wrapper").append('<div class="loading"></div>')}function p(){$("div.listings-wrapper div.loading").remove()}function f(e){var i=!0;"undefined"!=typeof e&&(i=!1),(i===!1||Z.val().length>2)&&(Z.prop("readonly",!0),R="default",j=!0,$("div.home-finder-filters").find("select option:selected").removeProp("selected"),$("#filter-builders").trigger("chosen:updated"),$("#filter-bedrooms").trigger("chosen:updated"),$("#filter-bathrooms").trigger("chosen:updated"),$("#filter-homeFeatures").multipleSelect("uncheckAll"),j=!1,u())}function u(e,i){if(j!==!0){"undefined"==typeof e&&(e="default");var t=$("#map-view-toggle").hasClass("active")?"map":"grid",n={prices:y(),bedrooms:k(),bathrooms:x(),searchAddress:b(),includePlans:v(),includeHomes:w(),builders:m(),homeFeatures:T(),squareFootage:S(),name:$(".home-finder").attr("data-nameType")};W.navigate("real-estate/home-finder/"+$(".home-finder").attr("data-nameType")+"/?"+$.param(n),{trigger:!1}),page=$(".pagination").attr("data-page",1),$("div.results-sort").show(),c(),$("div.listings-wrapper").fadeTo("slow",.3),h()===!1?M.show():M.hide(),g(n,e,i,t)}}function h(){return""===m()&&"0-500000"===y()&&""===k()&&""===x(),""===T()&&""===S()}function g(i,t,n,s){"undefined"==typeof t&&(t="default"),"undefined"==typeof n&&(n=!1);var a={prices:i.prices,bedrooms:i.bedrooms,bathrooms:i.bathrooms,searchAddress:i.searchAddress,sort:t,includePlans:i.includePlans,includeHomes:i.includeHomes,builders:i.builders,homeFeatures:i.homeFeatures,squareFootage:i.squareFootage,view:s,name:$(".home-finder").attr("data-nameType")};n===!0&&M.hide(),W.navigate("home-finder/search-listings/?"+$.param(a),{trigger:!1}),page=$(".pagination").data("page"),$.ajax({url:"/api/home-finder/search",data:a,success:function(i){var t=i.rsp,n=i.total;locations=[],p(),$("h2.listings-title").text("Search Listings"),$("div.results-count").text(pluralize("Result",n,!0)),$("div.home-finder-container").html(t).fadeTo("slow",1),"map"==s&&e(),Z.prop("readonly",!1),o()},error:function(e){Z.prop("readonly",!1),p(),$("div.listings-wrapper").html('<div class="end-results">End of Results</div>').fadeTo("slow",1),d("_","_")}})}function m(){return $("#filter-builders").find("option:selected").val()}function v(){var e=$("#filter-listings-type-copy").find("option:selected").val();return"home-plans"===e||"available-homes-and-plans"===e}function w(){var e=$("#filter-listings-type-copy").find("option:selected").val();return"available-homes"===e||"available-homes-and-plans"===e}function b(){return $("#filter-searchAddress").val()}function y(){return $("#minPriceFilter").val().replace(/\D/g,"")+"-"+$("#maxPriceFilter").val().replace(/\D/g,"")}function k(){var e,i=$("#filter-bedrooms");return i.find("option:selected").val()}function x(){var e,i=$("#filter-bathrooms");return i.find("option:selected").val()}function S(){return $("#filter-sqft").val()}function T(){return $("#filter-homeFeatures").multipleSelect("getSelects")}function C(e,i){$.post("/api/home-finder/properties/"+e+"/"+i)}function F(){$("a.color-box-group").colorbox({rel:"color-box-group",maxWidth:"75%"}),$("a.color-box-floor-plan").colorbox()}function P(){R="default",j=!0,$("#filter-searchAddress").val(""),J.noUiSlider.set([0,5e5]),$("#filter-builders, #filter-bedrooms, #filter-bathrooms, #filter-sqft").find("option").removeProp("selected"),$("#filter-builders, #filter-bedrooms, #filter-bathrooms, #filter-sqft").trigger("chosen:updated"),$("#filter-homeFeatures").multipleSelect("uncheckAll"),j=!1}function A(e,i){$.post("/api/home-finder/properties/"+i+"/share",{network:e},function(){})}function I(e){R="default",u()}var q,N,H,D,B;L.mapbox.accessToken="pk.eyJ1IjoiZGlkZXZjbyIsImEiOiJjaXM3cWY3NDEwNDc0Mnpwa2w5YnllMXZkIn0.4pWeAL6-vhtobhpFd2HDuA";var M=$("#saveSearchSection"),R="default";$("#grid-view-toggle").on("click",function(){$(this).hasClass("active")||($("#map-view-toggle").removeClass("active"),$(this).addClass("active"),$(".pagination").attr("data-page",1),u())}),$("#map-view-toggle").on("click",function(){$(this).hasClass("active")||($("#grid-view-toggle").removeClass("active"),$(this).addClass("active"),$(".pagination").attr("data-page",1),u())});var U=Backbone.Router.extend({routes:{"home-finder/properties/:address/:id/":"showProperty","home-finder/featured-listings/":"showFeaturedListings","home-finder/recently-listed/":"showRecentlyListed","home-finder/saved-listings/":"showSavedListings","home-finder/all-listings/":"showAllListings"},showSavedListings:function(){s()},showRecentlyListed:function(){a()},showFeaturedListings:function(){r()},showProperty:function(e,i){d(e,i)},showAllListings:function(){l()}}),W=new U;Backbone.history.started||(Backbone.history.start({pushState:"pushState"in window.history,silent:!0}),Backbone.history.started=!0,"home-finder/"===Backbone.history.getFragment()&&W.navigate("home-finder/featured-listings/",{trigger:!1,replace:!0})),$("#filter-bedrooms,#filter-bathrooms,#filter-builders,#filter-sqft").on("change",function(){$("#filter-searchAddress").val(""),R="default",u()}),$("div.listings-type select").on("change",function(){var e=$(this).find("option:selected").val();"home-plans"===e?$("div.view-on-map").css("visibility","hidden"):$("div.view-on-map").css("visibility","visible"),$("#filter-searchAddress").val(""),u()});var E,O=2e3,Z=$("#filter-searchAddress");Z.on("keyup",function(e){clearTimeout(E),"13"==event.keyCode?f(!0):E=setTimeout(f,O)}),Z.on("keydown",function(){clearTimeout(E),E=setTimeout(f,O)});var j=!1;$("div.all-listings-col").on("click","div.listings-wrapper div.listing:not(.offering,.floor-plan)",function(){var e=$(this).attr("data-property-id"),i=$(this).attr("data-property-address");$(this).parent().find("div.listing.active").removeClass("active"),$(this).addClass("active"),W.navigate("home-finder/properties/"+i+"/"+e+"/",{trigger:!0})}),$("div.all-listings-col").on("click","div.listings-wrapper div.floor-plan",function(){var e=$(this).attr("data-floor-plan-link"),i=$(this).attr("data-builder-title"),t=$(this).attr("data-floor-plan-title");$(this).parent().find("div.listing.active").removeClass("active"),$(this).addClass("active"),W.navigate(e,{trigger:!1}),$.get("/api/home-finder/floor-plans/"+i+"/"+t,{},function(e){var i=e.rsp;$("div.single-listing-col").html(i),$("div.single-listing-col .listing-images").slick({dots:!1,infinite:!1,speed:300,slidesToShow:2,centerMode:!1,arrows:!0,variableWidth:!0,respondTo:"window"})})}),$(".listing-images").slick({dots:!1,infinite:!1,speed:300,slidesToShow:2,centerMode:!1,arrows:!0,variableWidth:!0,respondTo:"window"});var z=_.throttle(function(){if($(this).scrollTop()+$(this).innerHeight()>=$(this)[0].scrollHeight-200){var e=$("div.infinite-check");if(e.length>0){e.removeClass("infinite-check");var i=e.attr("data-infinite-scroll-next-url");c(),$.get(i,{},function(e){p();var i=e.rsp;$("div.listings-wrapper").append(i)})}}},100);$("div.all-listings-col").on("scroll",z),$(".more-button").click(function(){$(".more-options").toggle("slow"),$(".home-finder-filters").toggleClass("more")}),$(".toggle-more").click(function(){$(".filter-options").toggle("slow")}),$("div.home-finder-main").on("click","div.save.action-link a",function(){if("undefined"==typeof DI||"undefined"==typeof DI.isLoggedIn||"true"!==DI.isLoggedIn)return $("a.showAccountPage").trigger("click"),!1;var e=$(this).attr("data-property-id"),i="save",t=$(this);return $(this).parent().hasClass("saved")&&(i="un-save"),"save"===i?(t.closest("div.action-link").find("div.not-saved").hide(),t.closest("div.action-link").find("div.saved").show()):(t.closest("div.action-link").find("div.not-saved").show(),t.closest("div.action-link").find("div.saved").hide()),C(e,i),!1}),F(),$("#filter-clearAll").on("click",function(){return P(),$("#filter-bathrooms").trigger("change"),!1}),$(document).on("click","a.sortByPriceHighToLow",function(){return u("price.desc"),!1}),$(document).on("click","a.sortByPriceLowToHigh",function(){return u("price.asc"),!1}),$(document).on("click","#requestShowing",function(){var e=$("#modal-request-showing");return e.modal("show"),e.find("button").prop("disabled",!1),e.find('input[name="name"]').val(""),e.find('input[name="email"]').val(""),e.find('textarea[name="message"]').val(""),e.find("span.success-message").hide(),e.find("span.error-message").hide(),e.find('input[name="createAccount"]').prop("checked",!1),e.find("form").show(),!1}),$(document).on("click","#modal-request-showing button",function(){var e=$(this).parent().find('input[name="propertyId"]').val(),i=$(this).parent().find('input[name="builderTitle"]').val(),t=$(this).parent().find('input[name="floorPlanTitle"]').val(),n=$(this).parent().find('input[name="name"]').val(),o=$(this).parent().find('input[name="email"]').val(),s=$(this).parent().find('input[name="link"]').val(),a=$(this).parent().find('textarea[name="message"]').val(),r=$(this).parent().find('input[name="createAccount"]').is(":checked"),l=$(this).parent().parent().find("span.success-message"),d=$(this).parent().find("span.error-message"),c=$(this);return c.prop("disabled",!0),d.hide(),l.hide(),c.text("Sending..."),$.ajax({type:"POST",url:"/api/home-finder/request-showing",data:{propertyId:e,builderTitle:i,floorPlanTitle:t,name:n,email:o,message:a,shouldCreateAccount:r},error:function(e){if(c.prop("disabled",!1),"undefined"!=typeof e.responseJSON){switch(e.responseJSON.status){case 404:c.parent().find('input[name="email"]').addClass("error"),d.text(e.responseJSON.rsp),d.show();break;case 500:default:d.text("Failed to save message. Please try again. If it still fails, go to the contact page and let us know. Thanks!"),d.show()}c.text("Send"),c.prop("disabled",!1)}},success:function(e){c.prop("disabled",!1),c.parent().hide(),l.show(),c.text("Send"),r===!0&&(window.location.href=s)}}),!1}),$(document).on("click","#accountSaveSearch",function(){if("undefined"==typeof DI||"undefined"==typeof DI.isLoggedIn||"true"!==DI.isLoggedIn)return $("a.showAccountPage").trigger("click"),!1;var e={prices:y(),bedrooms:k(),bathrooms:x(),squareFootage:S(),homeFeatures:T(),includePlans:v(),includeHomes:w(),builders:m()},i=$(this);return $.post("/api/home-finder/save-search",e,function(e){if("undefined"!=typeof e.savedSearchCount){var t=e.savedSearchCount;i.parent().find("a.showAccountPage").text("("+t+")"),i.parent().find("a.showAccountPage").show(),$("a.savedSearchesCount").text("Saved Searches "+t)}}),!1}),$(document).on("click","div.listing",function(){$(".single-listing-col").animate({scrollTop:"0px"})}),$(".col-map-listings").each(function(e,i){$(i).find(".map-results-box").matchHeight({byRow:!1})}),$(document).on("click","div.listing",function(){$(".single-listing-col").addClass("move-up"),$(".home-finder-filters").addClass("hide-filters")}),$(document).on("click","div.back-to-listings",function(){$(".single-listing-col").removeClass("move-up"),$(".home-finder-filters").removeClass("hide-filters")}),$(".all-listings-col").scroll(function(){var e=$(".all-listings-col").scrollTop();e>=250?$(".home-finder-filters").addClass("hide-filters"):$(".home-finder-filters").removeClass("hide-filters")}),$(document).on("click",".open-share-widget",function(){$(".share-widget").toggleClass("open")}),$(document).on("click",".share-icon",function(){$(".share-widget").removeClass("open")}),$(document).on("click","div.share-icon.fb-icon",function(){var e=$(this).parent().parent().attr("data-property-id");A("facebook",e)}),$(document).on("click","div.share-icon.twitter-icon",function(){var e=$(this).parent().parent().attr("data-property-id");A("twitter",e)}),$(document).on("click","div.share-icon.email-icon",function(){var e=$(this).parent().parent().attr("data-property-id");A("email",e)}),$("#filter-builders, #filter-bedrooms, #filter-listings-type, #filter-listings-type-copy").chosen({disable_search:"true"}),$("#filter-sq-ft, #filter-bathrooms").chosen({disable_search:"true",width:"165px"}),$("#filter-homeFeatures").multipleSelect({placeholder:"Home Features",onClick:I,onCheckAll:I,onUncheckAll:I}),$("#showPriceFilter").on("click",function(e){$("#priceFilterSection").show(),e.stopPropagation()}),$("#priceFilterSection").on("clickoutside",function(){$(this).hide()});var J=document.getElementById("filter-price");noUiSlider.create(J,{start:[0,5e5],connect:!0,step:5e4,range:{min:0,max:5e5},format:wNumb({decimals:0,thousand:",",prefix:"$"})}),J.noUiSlider.on("set",function(){$("#filter-searchAddress").val(""),R="default",u()}),J.noUiSlider.on("update",function(e,i){var t=[$("#minPriceFilter"),$("#maxPriceFilter")];t[i].val(e[i])}),$("#minPriceFilter").on("change",function(e){J.noUiSlider.set([$(this).val(),$("#maxPriceFilter").val()])}),$("#maxPriceFilter").on("change",function(e){J.noUiSlider.set([$("#minPriceFilter").val(),$(this).val()])}),$("#filter-listings-type").on("change",function(){$("#filter-listings-type-copy").find('option[value="'+$(this).find("option:selected").val()+'"]').prop("selected",!0),$("#filter-listings-type-copy").trigger("chosen:updated")}),$("#filter-listings-type-copy").on("change",function(){$("#filter-listings-type").find('option[value="'+$(this).find("option:selected").val()+'"]').prop("selected",!0),$("#filter-listings-type").trigger("chosen:updated");var e=$(this).find("option:selected").val();"home-plans"===e?$("div.view-on-map").css("visibility","hidden"):$("div.view-on-map").css("visibility","visible"),$("#filter-searchAddress").val(""),u()}),$(document).on("click","#fullscreen-map",function(){$(".col-map").toggleClass("open")}),$(document).on("click","#legend-title",function(){$("#legend-title").toggleClass("close"),$("#legend-items").toggleClass("close")})});
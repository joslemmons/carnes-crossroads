jQuery(function($){function e(){$("div.listings-wrapper").fadeTo("slow",.3),P.hide(),l(),$.get("/api/home-finder/saved-listings/page/1",{sort:I},function(e){var i=e.rsp,t=e.total;o(),$("h2.listings-title").text("Saved Listings"),$("div.results-count").text(pluralize("Result",t,!0)),$("div.listings-wrapper").html(i).fadeTo("slow",1),C(),$("#filter-searchAddress").val(""),$("div.listings-wrapper").find("div.listing").first().trigger("click")})}function i(){$("div.listings-wrapper").fadeTo("slow",.3),P.hide(),l(),$.get("/api/home-finder/recently-listed/page/1",{},function(e){var i=e.rsp,t=e.total;o(),$("h2.listings-title").text("Recently Listed"),$("div.results-count").text(pluralize("Result",t,!0)),$("div.listings-wrapper").html(i).fadeTo("slow",1),C(),$("#filter-searchAddress").val(""),$("div.listings-wrapper").find("div.listing").first().trigger("click")})}function t(){$("div.listings-wrapper").fadeTo("slow",.3),P.hide(),l(),$.get("/api/home-finder/new-offerings/page/1",{},function(e){var i=e.rsp,t=e.total;o(),$("h2.listings-title").text("New Offerings"),$("div.results-count").text(pluralize("Result",t,!0)),$("div.listings-wrapper").html(i).fadeTo("slow",1),C(),$("#filter-searchAddress").val(""),$("div.listings-wrapper").find("div.listing").first().trigger("click")})}function n(){$("div.listings-wrapper").fadeTo("slow",.3),P.hide(),l(),$.get("/api/home-finder/featured-properties/page/1",{sort:I},function(e){var i=e.rsp,t=e.total;o(),$("h2.listings-title").text("Featured Listings"),$("div.results-count").text(pluralize("Result",t,!0)),$("div.listings-wrapper").html(i).fadeTo("slow",1),C(),$("#filter-searchAddress").val(""),$("div.listings-wrapper").find("div.listing").first().trigger("click")})}function s(){$("div.listings-wrapper").fadeTo("slow",.3),C(),a("default",!0)}function r(e,i){$("div.single-listing-col").fadeTo("slow",.3),$.get("/api/home-finder/properties/"+i,{},function(e){var i=e.rsp;$("div.single-listing-col").html(i).fadeTo("slow",1),$("div.single-listing-col .listing-images").slick({lazyLoad:"ondemand",dots:!1,infinite:!1,speed:300,slidesToShow:2,slidesToScroll:1,centerMode:!1,arrows:!0,variableWidth:!0,respondTo:"window",responsive:[{breakpoint:991,settings:{slidesToShow:1,slidesToScroll:1,infinite:!1,variableWidth:!0}}]}),x()})}function l(){$("div.listings-wrapper").append('<div class="loading"></div>')}function o(){$("div.listings-wrapper div.loading").remove()}function a(e,i){if(N!==!0){"undefined"==typeof e&&(e="default");var t={prices:y(),bedrooms:A(),bathrooms:S(),searchAddress:m(),includePlans:p(),builders:f()};$("div.results-sort").show(),l(),$("div.listings-wrapper").fadeTo("slow",.3),d()===!1?P.show():P.hide(),c(t,e,i)}}function d(){return""===k()&&""===b()&&""===y()&&""===A()&&""===S()&&""===u()&&""===h()&&""===g()&&""===v()}function c(e,i,t){"undefined"==typeof i&&(i="default"),"undefined"==typeof t&&(t=!1),t===!0&&P.hide(),$.get("/api/home-finder/search",{prices:e.prices,bedrooms:e.bedrooms,bathrooms:e.bathrooms,searchAddress:e.searchAddress,sort:i,includePlans:e.includePlans,builders:e.builders},function(e){var i=e.rsp,n=e.total;locations=[],o(),t===!1?($("h2.listings-title").text("Search Listings"),$("div.listings-type").find("select").find("option").first().prop("selected","selected")):$("h2.listings-title").text("All Listings"),$("div.results-count").text(pluralize("Result",n,!0)),$("div.listings-wrapper").html(i).fadeTo("slow",1),$("div.listings-wrapper").find("div.listing").first().trigger("click")})}function f(){return $("#filter-builders").find("option:selected").val()}function p(){return $("#filter-includePlans").is(":checked")}function u(){return $("#filter-lastUpdate").val()}function h(){return $("#filter-sqft").find("option:selected").val()}function g(){return $("#filter-homeFeatures").multipleSelect("getSelects")}function v(){return $("#filter-view").multipleSelect("getSelects")}function m(){return $("#filter-searchAddress").val()}function w(){return!0}function k(){return $("#filter-propertyType").multipleSelect("getSelects")}function b(){return $("#filter-neighborhood").multipleSelect("getSelects")}function y(){var e,i=$("#filter-price");return i.find("option:selected").val()}function A(){var e,i=$("#filter-bedrooms");return i.find("option:selected").val()}function S(){var e,i=$("#filter-bathrooms");return i.find("option:selected").val()}function T(e,i){$.post("/api/home-finder/properties/"+e+"/"+i)}function x(){$("a.color-box-group").colorbox({rel:"color-box-group",maxWidth:"75%"}),$("a.color-box-floor-plan").colorbox()}function C(){I="default",N=!0,$("div.home-finder-filters").find("select option:selected").removeProp("selected"),$("#filter-searchAddress").val(""),$("#filter-includePlans").prop("checked",!1),$("#filter-propertyType").multipleSelect("uncheckAll"),$("#filter-neighborhood").multipleSelect("uncheckAll"),$("#filter-homeFeatures").multipleSelect("uncheckAll"),$("#filter-view").multipleSelect("uncheckAll"),N=!1}function L(e,i){$.post("/api/home-finder/properties/"+i+"/share",{network:e},function(){})}var P=$("#saveSearchSection"),I="default",F=Backbone.Router.extend({routes:{"home-finder/properties/:address/:id/":"showProperty","home-finder/featured-listings/":"showFeaturedListings","home-finder/new-offerings/":"showNewOfferings","home-finder/recently-listed/":"showRecentlyListed","home-finder/saved-listings/":"showSavedListings","home-finder/all-listings/":"showAllListings"},showSavedListings:function(){e()},showRecentlyListed:function(){i()},showNewOfferings:function(){t()},showFeaturedListings:function(){n()},showProperty:function(e,i){r(e,i)},showAllListings:function(){s()}}),B=new F;Backbone.history.started||(Backbone.history.start({pushState:"pushState"in window.history,silent:!0}),Backbone.history.started=!0,"home-finder/"===Backbone.history.getFragment()&&B.navigate("home-finder/featured-listings/",{trigger:!1,replace:!0})),$("#filter-price,#filter-bedrooms,#filter-bathrooms,#filter-lastUpdate,#filter-sqft,#filter-builders").on("change",function(){$("#filter-searchAddress").val(""),I="default",a()}),$("#filter-mlsListing").on("click",function(){$("#filter-searchAddress").val(""),a()}),$("#filter-includePlans").on("click",function(){$("#filter-searchAddress").val(""),a()});var R=_.throttle(function(){$(this).val().length>2&&(C(),a())},2e3);$("#filter-searchAddress").on("keyup",R);var N=!1;$("div.all-listings-col").on("click","div.listings-wrapper div.listing:not(.offering,.floor-plan)",function(){var e=$(this).attr("data-property-id"),i=$(this).attr("data-property-address");$(this).parent().find("div.listing.active").removeClass("active"),$(this).addClass("active"),B.navigate("home-finder/properties/"+i+"/"+e+"/",{trigger:!0})}),$("div.all-listings-col").on("click","div.listings-wrapper div.floor-plan",function(){var e=$(this).attr("data-floor-plan-link"),i=$(this).attr("data-builder-title"),t=$(this).attr("data-floor-plan-title");$(this).parent().find("div.listing.active").removeClass("active"),$(this).addClass("active"),B.navigate(e,{trigger:!1}),$.get("/api/home-finder/floor-plans/"+i+"/"+t,{},function(e){var i=e.rsp;$("div.single-listing-col").html(i),$("div.single-listing-col .listing-images").slick({dots:!1,infinite:!1,speed:300,slidesToShow:2,centerMode:!1,arrows:!0,variableWidth:!0,respondTo:"window"})})}),$("div.all-listings-col").on("click","div.listings-wrapper div.offering",function(){var e=$(this).attr("data-offering-link"),i=$(this).attr("data-offering-id");$(this).parent().find("div.listing.active").removeClass("active"),$(this).addClass("active"),B.navigate(e,{trigger:!1}),$.get("/api/home-finder/new-offerings/"+i,{},function(e){var i=e.rsp;$("div.single-listing-col").html(i),$("div.single-listing-col .listing-images").slick({dots:!1,infinite:!1,speed:300,slidesToShow:2,centerMode:!1,arrows:!0,variableWidth:!0,respondTo:"window"})})}),$("div.listings-type select").on("change",function(){var r=$(this).find("option:selected").val();switch(r){case"new-offerings":B.navigate("home-finder/new-offerings/",{trigger:!1}),$("div.results-sort").hide(),t();break;case"recently-listed":B.navigate("home-finder/recently-listed/",{trigger:!1}),$("div.results-sort").hide(),i();break;case"saved-listings":B.navigate("home-finder/saved-listings/",{trigger:!1}),$("div.results-sort").show(),e();break;case"all-listings":B.navigate("home-finder/all-listings/",{trigger:!1}),$("div.results-sort").show(),s();break;case"featured-listings":default:B.navigate("home-finder/featured-listings/",{trigger:!1}),$("div.results-sort").show(),n()}}),$(".listing-images").slick({dots:!1,infinite:!1,speed:300,slidesToShow:2,centerMode:!1,arrows:!0,variableWidth:!0,respondTo:"window"});var q=_.throttle(function(){if($(this).scrollTop()+$(this).innerHeight()>=$(this)[0].scrollHeight-200){var e=$("div.infinite-check");if(e.length>0){e.removeClass("infinite-check");var i=e.attr("data-infinite-scroll-next-url");l(),$.get(i,{},function(e){o();var i=e.rsp;$("div.listings-wrapper").append(i)})}}},100);$("div.all-listings-col").on("scroll",q),$(".more-button").click(function(){$(".more-options").toggle("slow")}),$(".toggle-more").click(function(){$(".filter-options").toggle("slow")}),$("div.home-finder-main").on("click","div.save.action-link a",function(){if("undefined"==typeof DI||"undefined"==typeof DI.isLoggedIn||"true"!==DI.isLoggedIn)return $("a.showAccountPage").trigger("click"),!1;var e=$(this).attr("data-property-id"),i="save",t=$(this);return $(this).parent().hasClass("saved")&&(i="un-save"),"save"===i?(t.closest("div.action-link").find("div.not-saved").hide(),t.closest("div.action-link").find("div.saved").show()):(t.closest("div.action-link").find("div.not-saved").show(),t.closest("div.action-link").find("div.saved").hide()),T(e,i),!1}),x(),$(document).on("click","a.filterByPropertyType",function(){var e=$(this).attr("data-property-type");return I="default",C(),$("#filter-propertyType").find('option[value="'+e.toLowerCase()+'"]').prop("selected","selected"),$("#filter-bathrooms").trigger("change"),!1}),$(document).on("click","a.filterByNeighborhood",function(){var e=$(this).attr("data-neighborhood");return I="default",C(),$("#filter-neighborhood").find("option:contains("+e+")").prop("selected","selected"),$("#filter-bathrooms").trigger("change"),!1}),$("#filter-clearAll").on("click",function(){return C(),$("#filter-bathrooms").trigger("change"),!1}),$(document).on("click","a.sortByPriceHighToLow",function(){var e=$("div.listings-type").find("select").find("option:selected");if(""===e.val()||"Select Filters"===e.val()||"all-listings"===e.val()){var i=!1;"all-listings"===e.val()&&(i=!0),a("price.desc",i)}else I="price.desc",$("div.listings-type select").trigger("change");return!1}),$(document).on("click","a.sortByPriceLowToHigh",function(){var e=$("div.listings-type").find("select").find("option:selected");if(""===e.val()||"Select Filters"===e.val()||"all-listings"===e.val()){var i=!1;"all-listings"===e.val()&&(i=!0),a("price.asc",i)}else I="price.asc",$("div.listings-type select").trigger("change");return!1}),$(document).on("click","#requestShowing",function(){var e=$("#modal-request-showing");return e.modal("show"),e.find("button").prop("disabled",!1),e.find('input[name="name"]').val(""),e.find('input[name="email"]').val(""),e.find('textarea[name="message"]').val(""),e.find("span.success-message").hide(),e.find("span.error-message").hide(),e.find('input[name="createAccount"]').prop("checked",!1),e.find("form").show(),!1}),$(document).on("click","#modal-request-showing button",function(){var e=$(this).parent().find('input[name="propertyId"]').val(),i=$(this).parent().find('input[name="builderTitle"]').val(),t=$(this).parent().find('input[name="floorPlanTitle"]').val(),n=$(this).parent().find('input[name="name"]').val(),s=$(this).parent().find('input[name="email"]').val(),r=$(this).parent().find('input[name="link"]').val(),l=$(this).parent().find('textarea[name="message"]').val(),o=$(this).parent().find('input[name="createAccount"]').is(":checked"),a=$(this).parent().parent().find("span.success-message"),d=$(this).parent().find("span.error-message"),c=$(this);return c.prop("disabled",!0),d.hide(),a.hide(),c.text("Sending..."),$.ajax({type:"POST",url:"/api/home-finder/request-showing",data:{propertyId:e,builderTitle:i,floorPlanTitle:t,name:n,email:s,message:l,shouldCreateAccount:o},error:function(e){if(c.prop("disabled",!1),"undefined"!=typeof e.responseJSON){switch(e.responseJSON.status){case 404:c.parent().find('input[name="email"]').addClass("error"),d.text(e.responseJSON.rsp),d.show();break;case 500:default:d.text("Failed to save message. Please try again. If it still fails, go to the contact page and let us know. Thanks!"),d.show()}c.text("Send"),c.prop("disabled",!1)}},success:function(e){c.prop("disabled",!1),c.parent().hide(),a.show(),c.text("Send"),o===!0&&(window.location.href=r)}}),!1}),$(document).on("click","#accountSaveSearch",function(){if("undefined"==typeof DI||"undefined"==typeof DI.isLoggedIn||"true"!==DI.isLoggedIn)return $("a.showAccountPage").trigger("click"),!1;var e={propertyTypes:k(),neighborhoods:b(),prices:y(),bedrooms:A(),bathrooms:S(),shouldSearchMLS:w(),lastUpdate:u(),squareFootage:h(),homeFeatures:g(),views:v(),includePlans:p(),builders:f()},i=parseInt($(this).parent().find("a.showAccountPage").text().replace("(","").replace(")",""));return i++,$(this).parent().find("a.showAccountPage").text("("+i+")"),$(this).parent().find("a.showAccountPage").show(),$.post("/api/home-finder/save-search",e,function(e){}),!1}),$(document).on("click","div.listing",function(){$(".single-listing-col").animate({scrollTop:"0px"})}),$(document).on("click","div.listing",function(){$(".single-listing-col").addClass("move-up"),$(".home-finder-filters").addClass("hide-filters")}),$(document).on("click","div.back-to-listings",function(){$(".single-listing-col").removeClass("move-up"),$(".home-finder-filters").removeClass("hide-filters")}),$(".all-listings-col").scroll(function(){var e=$(".all-listings-col").scrollTop();e>=250?$(".home-finder-filters").addClass("hide-filters"):$(".home-finder-filters").removeClass("hide-filters")}),$(document).on("click",".open-share-widget",function(){$(".share-widget").toggleClass("open")}),$(document).on("click",".share-icon",function(){$(".share-widget").removeClass("open")}),$(document).on("click","div.share-icon.fb-icon",function(){var e=$(this).parent().parent().attr("data-property-id");L("facebook",e)}),$(document).on("click","div.share-icon.twitter-icon",function(){var e=$(this).parent().parent().attr("data-property-id");L("twitter",e)}),$(document).on("click","div.share-icon.email-icon",function(){var e=$(this).parent().parent().attr("data-property-id");L("email",e)}),$("#filter-propertyType").multipleSelect({placeholder:"Property Type",onClick:function(e){$("#filter-searchAddress").val(""),I="default",a()},onCheckAll:function(){$("#filter-searchAddress").val(""),I="default",a()},onUncheckAll:function(){$("#filter-searchAddress").val(""),I="default",a()}}),$("#filter-neighborhood").multipleSelect({placeholder:"Neighborhood",onClick:function(e){$("#filter-searchAddress").val(""),I="default",a()},onCheckAll:function(){$("#filter-searchAddress").val(""),I="default",a()},onUncheckAll:function(){$("#filter-searchAddress").val(""),I="default",a()}}),$("#filter-homeFeatures").multipleSelect({placeholder:"Home Features",onClick:function(e){$("#filter-searchAddress").val(""),I="default",a()},onCheckAll:function(){$("#filter-searchAddress").val(""),I="default",a()},onUncheckAll:function(){$("#filter-searchAddress").val(""),I="default",a()}}),$("#filter-view").multipleSelect({placeholder:"View",onClick:function(e){$("#filter-searchAddress").val(""),I="default",a()},onCheckAll:function(){$("#filter-searchAddress").val(""),I="default",a()},onUncheckAll:function(){$("#filter-searchAddress").val(""),I="default",a()}}),$("#filter-builders, #filter-price, #filter-bedrooms, #filter-bathrooms, #filter-listings-type").chosen({disable_search:"true"})});
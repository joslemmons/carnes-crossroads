jQuery(function($){function e(){$("div.listings-wrapper").append('<div class="loading"></div>')}function t(){$("div.listings-wrapper div.loading").remove()}function i(){var t={propertyTypes:a(),neighborhoods:l(),prices:d(),bedrooms:c(),bathrooms:p(),shouldSearchMLS:r(),searchAddress:s()};e(),$("div.listings-wrapper").fadeTo("slow",.3),o()===!1?u.show():u.hide(),n(t)}function o(){return""===a()&&""===l()&&""===d()&&""===c()&&""===p()}function n(e){$.get("/api/home-finder/search",{propertyTypes:e.propertyTypes,neighborhoods:e.neighborhoods,prices:e.prices,bedrooms:e.bedrooms,bathrooms:e.bathrooms,searchMLS:e.shouldSearchMLS,searchAddress:e.searchAddress},function(e){var i=e.rsp,o=e.total;locations=[],t(),$("h2.listings-title").text("Search Listings"),$("div.results-count").text(pluralize("Result",o,!0)),$("div.listings-wrapper").html(i).fadeTo("slow",1),$("div.listings-type").find("select").find("option").first().prop("selected","selected")})}function s(){return $("#filter-searchAddress").val()}function r(){return!0}function a(){var e,t=$("#filter-propertyType");return t.find("option:selected").val()}function l(){var e,t=$("#filter-neighborhood");return t.find("option:selected").val()}function d(){var e,t=$("#filter-price");return t.find("option:selected").val()}function c(){var e,t=$("#filter-bedrooms");return t.find("option:selected").val()}function p(){var e,t=$("#filter-bathrooms");return t.find("option:selected").val()}function g(e,t){$.post("/api/home-finder/properties/"+e+"/"+t)}function f(){$("a.color-box-group").colorbox({rel:"color-box-group",maxWidth:"75%"}),$("a.color-box-floor-plan").colorbox()}function h(e,t){for(var i=new google.maps.MarkerImage(DI.templateUri+"/img/imap/icons/house-icon.png",new google.maps.Size(20,32),new google.maps.Point(0,0),new google.maps.Point(5,20)),o=new google.maps.MarkerImage(DI.templateUri+"/img/imap/icons/lot-icon.png",new google.maps.Size(20,32),new google.maps.Point(0,0),new google.maps.Point(5,20)),n,s={coord:[1,1,1,32,20,32,20,1],type:"poly"},r=0;r<t.length;r++){var a=t[r],l=a[0],d=a[3],c=a[4],p=a[5],g=a[6];if(a[1]&&a[2]){var f=new google.maps.LatLng(a[1],a[2]);if(0!=g)var h=i;else var h=o;var m=v(e,f,h,n,l,d,c,p)}else P.geocode({address:a[0]},function(t,s){if(s==google.maps.GeocoderStatus.OK){if(g)var r=i;else var r=o;var a=v(e,t[0].geometry.location,r,n,l,d,c,p)}else alert("Geocode was not successful for the following reason: "+s)})}}function v(e,t,i,o,n,s,r,a){var l=a,d=new google.maps.Marker({position:t,map:e,icon:i,zIndex:99999,clickable:!0});return google.maps.event.addListener(d,"click",function(){A.setContent(l),A.open(e,d)}),d}function m(e){var t={zoom:T,center:new google.maps.LatLng(33.055457,-80.103917),navigationControl:!0,mapTypeControl:!1,scaleControl:!1,mapTypeId:google.maps.MapTypeId.ROADMAP},i=new google.maps.Map(document.getElementById("imap"),t);i.overlayMapTypes.insertAt(0,L),overlay=new google.maps.OverlayView,overlay.draw=function(){},overlay.setMap(i),google.maps.event.addListener(i,"zoom_changed",function(){i.getZoom()<T&&i.setZoom(T),i.getZoom()>S&&i.setZoom(S)}),h(i,e),$("#modal-view-on-map").on("shown.bs.modal",function(){google.maps.event.trigger(i,"resize"),1===e.length?i.setCenter(new google.maps.LatLng(locations[0][1],locations[0][2])):i.setCenter(new google.maps.LatLng(33.055457,-80.103917))})}var u=$("#saveSearchSection"),w=Backbone.Router.extend({routes:{"real-estate/home-finder/properties/:address/:id/":"showProperty","real-estate/home-finder/featured-listings/":"showFeaturedListings","real-estate/home-finder/new-offerings/":"showNewOfferings","real-estate/home-finder/recently-listed/":"showRecentlyListed","real-estate/home-finder/saved-listings/":"showSavedListings"},showSavedListings:function(){$("div.listings-wrapper").fadeTo("slow",.3),u.hide(),e(),$.get("/api/home-finder/saved-listings/page/1",{},function(e){var i=e.rsp,o=e.total;t(),$("h2.listings-title").text("Saved Listings"),$("div.results-count").text(pluralize("Result",o,!0)),$("div.listings-wrapper").html(i).fadeTo("slow",1),$("div.home-finder-filters").find("select option:selected").removeProp("selected"),$("#filter-searchAddress").val("")})},showRecentlyListed:function(){$("div.listings-wrapper").fadeTo("slow",.3),u.hide(),e(),$.get("/api/home-finder/recently-listed/page/1",{},function(e){var i=e.rsp,o=e.total;t(),$("h2.listings-title").text("Recently Listed"),$("div.results-count").text(pluralize("Result",o,!0)),$("div.listings-wrapper").html(i).fadeTo("slow",1),$("div.home-finder-filters").find("select option:selected").removeProp("selected"),$("#filter-searchAddress").val("")})},showNewOfferings:function(){$("div.listings-wrapper").fadeTo("slow",.3),u.hide(),e(),$.get("/api/home-finder/new-offerings/page/1",{},function(e){var i=e.rsp,o=e.total;t(),$("h2.listings-title").text("New Offerings"),$("div.results-count").text(pluralize("Result",o,!0)),$("div.listings-wrapper").html(i).fadeTo("slow",1),$("div.home-finder-filters").find("select option:selected").removeProp("selected"),$("#filter-searchAddress").val("")})},showFeaturedListings:function(){$("div.listings-wrapper").fadeTo("slow",.3),u.hide(),e(),$.get("/api/home-finder/featured-properties/page/1",{},function(e){var i=e.rsp,o=e.total;t(),$("h2.listings-title").text("Featured Listings"),$("div.results-count").text(pluralize("Result",o,!0)),$("div.listings-wrapper").html(i).fadeTo("slow",1),$("div.home-finder-filters").find("select option:selected").removeProp("selected"),$("#filter-searchAddress").val("")})},showProperty:function(e,t){$("div.single-listing-col").fadeTo("slow",.3),$.get("/api/home-finder/properties/"+t,{},function(e){var t=e.rsp;$("div.single-listing-col").html(t).fadeTo("slow",1),$("div.single-listing-col .listing-images").slick({dots:!1,infinite:!0,speed:300,slidesToShow:2,slidesToScroll:1,centerMode:!1,arrows:!0,variableWidth:!0,respondTo:"window",responsive:[{breakpoint:991,settings:{slidesToShow:1,slidesToScroll:1,infinite:!0,variableWidth:!0}}]}),f()})}}),y=new w;Backbone.history.started||(Backbone.history.start({pushState:"pushState"in window.history,silent:!0}),Backbone.history.started=!0,"real-estate/home-finder/"===Backbone.history.getFragment()&&y.navigate("real-estate/home-finder/featured-listings/",{trigger:!1,replace:!0})),$("div.home-finder-filters").find("select").on("change",function(){$("#filter-searchAddress").val(""),i()}),$("#filter-mlsListing").on("click",function(){$("#filter-searchAddress").val(""),i()});var k=_.throttle(function(){$(this).val().length>2&&($("div.home-finder-filters").find("select option:selected").removeProp("selected"),i())},2e3);$("#filter-searchAddress").on("keyup",k),$("div.all-listings-col").on("click","div.listings-wrapper div.listing:not(.offering)",function(){var e=$(this).attr("data-property-id"),t=$(this).attr("data-property-address");$(this).parent().find("div.listing.active").removeClass("active"),$(this).addClass("active"),y.navigate("real-estate/home-finder/properties/"+t+"/"+e+"/",{trigger:!0})}),$("div.all-listings-col").on("click","div.listings-wrapper div.offering",function(){var e=$(this).attr("data-offering-link"),t=$(this).attr("data-offering-id");$(this).parent().find("div.listing.active").removeClass("active"),$(this).addClass("active"),y.navigate(e,{trigger:!1}),$.get("/api/home-finder/new-offerings/"+t,{},function(e){var t=e.rsp;$("div.single-listing-col").html(t),$("div.single-listing-col .listing-images").slick({dots:!1,infinite:!0,speed:300,slidesToShow:2,centerMode:!1,arrows:!0,variableWidth:!0,respondTo:"window"})})}),$("div.listings-type select").on("change",function(){var e=$(this).find("option:selected").val();switch(e){case"new-offerings":y.navigate("real-estate/home-finder/new-offerings/",{trigger:!0});break;case"recently-listed":y.navigate("real-estate/home-finder/recently-listed/",{trigger:!0});break;case"saved-listings":y.navigate("real-estate/home-finder/saved-listings/",{trigger:!0});break;case"featured-listings":default:y.navigate("real-estate/home-finder/featured-listings/",{trigger:!0})}}),$(".listing-images").slick({dots:!1,infinite:!0,speed:300,slidesToShow:2,centerMode:!1,arrows:!0,variableWidth:!0,respondTo:"window"});var b=_.throttle(function(){if($(this).scrollTop()+$(this).innerHeight()>=$(this)[0].scrollHeight-200){var i=$("div.infinite-check");if(i.length>0){i.removeClass("infinite-check");var o=i.attr("data-infinite-scroll-next-url");e(),$.get(o,{},function(e){t();var i=e.rsp;$("div.listings-wrapper").append(i)})}}},100);$("div.all-listings-col").on("scroll",b),$(".more-button").click(function(){$(".more-options").toggle("slow")}),$(".toggle-more").click(function(){$(".filter-options").toggle("slow")}),$("div.home-finder-main").on("click","div.save.action-link a",function(){var e=$(this).attr("data-property-id"),t="save",i=$(this);return $(this).parent().hasClass("saved")&&(t="un-save"),"save"===t?(i.closest("div.action-link").find("div.not-saved").hide(),i.closest("div.action-link").find("div.saved").show()):(i.closest("div.action-link").find("div.not-saved").show(),i.closest("div.action-link").find("div.saved").hide()),g(e,t),!1}),f(),$(document).on("click","a.filterByPropertyType",function(){var e=$(this).attr("data-property-type");return $("div.home-finder-filters").find("select option:selected").removeProp("selected"),$("#filter-propertyType").find('option[value="'+e.toLowerCase()+'"]').prop("selected","selected"),$("#filter-propertyType").trigger("change"),!1}),$(document).on("click","a.filterByNeighborhood",function(){var e=$(this).attr("data-neighborhood");return $("div.home-finder-filters").find("select option:selected").removeProp("selected"),$("#filter-neighborhood").find("option:contains("+e+")").prop("selected","selected"),$("#filter-neighborhood").trigger("change"),!1}),$("#filter-clearAll").on("click",function(){return $("div.home-finder-filters").find("select option:selected").removeProp("selected"),$("#filter-searchAddress").val(""),$("#filter-propertyType").trigger("change"),!1}),$(document).on("click","#requestShowing",function(){var e=$("#modal-request-showing");return e.modal("show"),e.find("button").prop("disabled",!1),e.find('input[name="name"]').val(""),e.find('input[name="email"]').val(""),e.find('textarea[name="message"]').val(""),e.find("span.success-message").hide(),e.find("span.error-message").hide(),e.find('input[name="createAccount"]').prop("checked",!1),e.find("form").show(),!1}),$(document).on("click","#modal-request-showing button",function(){var e=$(this).parent().find('input[name="propertyId"]').val(),t=$(this).parent().find('input[name="name"]').val(),i=$(this).parent().find('input[name="email"]').val(),o=$(this).parent().find('input[name="link"]').val(),n=$(this).parent().find('textarea[name="message"]').val(),s=$(this).parent().find('input[name="createAccount"]').is(":checked"),r=$(this).parent().parent().find("span.success-message"),a=$(this).parent().find("span.error-message"),l=$(this);return l.prop("disabled",!0),a.hide(),r.hide(),l.text("Sending..."),$.ajax({type:"POST",url:"/api/home-finder/request-showing",data:{propertyId:e,name:t,email:i,message:n,shouldCreateAccount:s},error:function(e){if(l.prop("disabled",!1),"undefined"!=typeof e.responseJSON){switch(e.responseJSON.status){case 404:l.parent().find('input[name="email"]').addClass("error"),a.text(e.responseJSON.rsp),a.show();break;case 500:default:a.text("Failed to save message. Please try again. If it still fails, go to the contact page and let us know. Thanks!"),a.show()}l.text("Send"),l.prop("disabled",!1)}},success:function(e){l.prop("disabled",!1),l.parent().hide(),r.show(),l.text("Send"),s===!0&&(window.location.href=o)}}),!1}),$("#modal-view-on-map").on("hidden.bs.modal",function(e){$("#imap").empty()}),$(document).on("click","#viewListingsOnMap",function(){var e=$("#modal-view-on-map");return e.modal("show"),m(locations),!1}),$(document).on("click","#viewOnMap",function(){var e=$("#modal-view-on-map"),t=$(this).attr("data-latitude"),i=$(this).attr("data-longitude"),o=$(this).attr("data-address"),n=$(this).attr("data-link"),s=$(this).attr("data-property-type"),r=$(this).attr("data-tool-tip");"Homesite"===s&&(s=0),e.modal("show"),m([[o,t,i,"4",n,r,s]])}),$(document).on("click","a.showProperty",function(){var e=$(this).attr("data-property-id"),t=$(this).attr("data-property-address");return $("div.listing.active").removeClass("active"),$('div.listing[data-property-id="'+e+'"]').addClass("active"),y.navigate("real-estate/home-finder/properties/"+t+"/"+e+"/",{trigger:!0}),$("#modal-view-on-map").modal("hide"),!1});var T=17,S=19,x={getTileUrl:function(e,t){var i=1<<t,o=i-e.y-1;return url=DI.templateUri+"/img/imap/tiles/"+t+"/"+e.x+"/"+o+".png",url},tileSize:new google.maps.Size(256,256),isPng:!0},L=new google.maps.ImageMapType(x),C=new google.maps.LatLngBounds,P=new google.maps.Geocoder,A=new google.maps.InfoWindow({size:new google.maps.Size(150,50)});$(document).on("click","#accountSaveSearch",function(){var e={propertyTypes:a(),neighborhoods:l(),prices:d(),bedrooms:c(),bathrooms:p(),shouldSearchMLS:r()},t=parseInt($(this).parent().find("a.showAccountPage").text().replace("(","").replace(")",""));return t++,$(this).parent().find("a.showAccountPage").text("("+t+")"),$(this).parent().find("a.showAccountPage").show(),$.post("/api/home-finder/save-search",e,function(e){}),!1}),$(document).on("click","div.listing",function(){$(".single-listing-col").addClass("move-up"),$(".home-finder-filters").addClass("hide-filters")}),$(document).on("click","div.back-to-listings",function(){$(".single-listing-col").removeClass("move-up"),$(".home-finder-filters").removeClass("hide-filters")}),$(document).on("click",".open-share-widget",function(){$(".share-widget").toggleClass("open")}),$(document).on("click",".share-icon",function(){$(".share-widget").removeClass("open")})});